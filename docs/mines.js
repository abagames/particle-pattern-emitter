!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions={isMirrorX:!1,isMirrorY:!1,seed:0,hue:null,saturation:.8,value:1,rotationNum:1,scale:null,scaleX:null,scaleY:null,scalePattern:1,scalePatternX:null,scalePatternY:null,isRotatingRight:!1,isRotatingLeft:!1,isReverseX:!1,isReverseY:!1,isAddingEdgeFirst:!1,isInnerEdge:!1,colorNoise:.1,colorLighting:1,edgeDarkness:.4,isShowingEdge:!0,isShowingBody:!0,isLimitingColors:!1,isUsingLetterForm:!1,letterFormChar:"x",letterFormFontFamily:"monospace",letterFormFontSize:16,letterWidthRatio:.8,letterHeightRatio:.9};let i={},r={},s=0;function o(e,n={}){n.baseSeed=s;let r=Array.isArray(e)?e:e.split("\n");const o=JSON.stringify({patterns:r,options:n});if(i[o])return i[o];let a={};g(t.defaultOptions,(e,t)=>{a[t]=e}),g(n,(e,t)=>{a[t]=e});const l=new S;let u=s+function(e){let t=0;const n=e.length;for(let i=0;i<n;i++){const n=e.charCodeAt(i);t=(t<<5)-t+n,t|=0}return t}(r.join());null!=a.seed&&(u+=a.seed),l.setSeed(u),null==a.hue&&(a.hue=l.get()),null==a.scalePatternX&&(a.scalePatternX=a.scalePattern),null==a.scalePatternY&&(a.scalePatternY=a.scalePattern),a.isUsingLetterForm&&(r=function(e,t){const n=y(e,(e,t)=>Math.max(e,t.length),0),i=e.length,r=t.letterFormFontSize,s=Math.round(n*r*t.letterWidthRatio),o=Math.round(i*r*1.2*t.letterHeightRatio),a=document.createElement("canvas");a.width=s,a.height=o;const l=a.getContext("2d");l.font=`${r}px ${t.letterFormFontFamily}`,l.textBaseline="top",f(n,n=>{f(i,i=>{l.fillText(e[i][n],n*r*t.letterWidthRatio,i*r*1.2*t.letterHeightRatio)})});const u=l.getImageData(0,0,s,o).data,h=function(e,t,n){let i=t,r=-1,s=n,o=-1,a=3;return f(n,n=>{f(t,t=>{e[a]>0&&(i=t<i?t:i,r=t>r?t:r,s=n<s?n:s,o=n>o?n:o),a+=4})}),{bx:i,ex:r,by:s,ey:o}}(u,s,o),c=h.ex-h.bx+1;let d=[];return f(h.ey-h.by+1,e=>{let n="";f(c,i=>{const r=4*(i+h.bx+(e+h.by)*s)+3;n+=u[r]>.5?t.letterFormChar:" "}),d.push(n)}),d}(r,a));let b,v=function(e,t,n){let i=y(e,(e,t)=>Math.max(e,t.length),0),r=e.length,s=Math.round(i*t.scalePatternX),o=Math.round(r*t.scalePatternY);s+=t.isMirrorX?1:2,o+=t.isMirrorY?1:2;let a=function(e,t,n,i,r,s,o,a,l,u){let c=p(i,i=>{const l=Math.floor((i-1)/s);return p(r,i=>{const r=Math.floor((i-1)/o);if(l<0||l>=t||r<0||r>=n)return 0;const s=l<e[r].length?e[r][l]:" ";let h=0;return"-"===s?h=u.get()<.5?1:a?.5:0:"x"===s||"X"===s?h=u.get()<.5?1:-1:"o"===s||"O"===s?h=-1:"*"===s&&(h=1),h})});return a&&(c=m(c=h(c,i,r,a,l),e=>m(e,e=>Math.floor(e)))),c}(e,i,r,s,o,t.scalePatternX,t.scalePatternY,t.isAddingEdgeFirst,t.isInnerEdge,n);if(t.isMirrorX&&(a=function(e,t,n){return p(2*t,i=>p(n,n=>i<t?e[i][n]:e[2*t-i-1][n]))}(a,s,o),s*=2),t.isMirrorY&&(a=function(e,t,n){return p(t,t=>p(2*n,i=>i<n?e[t][i]:e[t][2*n-i-1]))}(a,s,o),o*=2),t.isRotatingRight||t.isRotatingLeft){a=function(e,t,n,i){return p(n,i?i=>p(t,t=>e[t][n-1-i]):n=>p(t,i=>e[t-1-i][n]))}(a,s,o,t.isRotatingRight);const e=s;s=o,o=e}return(t.isReverseX||t.isReverseY)&&(a=function(e,t,n,i){return p(t,i?i=>p(n,n=>e[t-1-i][n]):t=>p(n,i=>e[t][n-1-i]))}(a,s,o,t.isReverseX)),a=h(a,s,o,!1,t.isInnerEdge),(null!=t.scale||null!=t.scaleX||null!=t.scaleY)&&(a=function(e,t,n,i){const r=null!=i.scaleX?i.scaleX:null!=i.scale?i.scale:1,s=null!=i.scaleY?i.scaleY:null!=i.scale?i.scale:1,o=Math.round(t*r),a=Math.round(n*s);let l=p(o,i=>{const o=Math.floor((i-1)/r);return p(a,i=>{const r=Math.floor((i-1)/s);return o<0||o>=t||r<0||r>=n?0:e[o][r]})});const u=(r+s)/2;return f(Math.floor((u-1)/2),()=>{l=function(e,t,n){return p(t,i=>p(n,r=>-1===e[i][r]&&c(e,t,n,0,i,r)?0:-1===e[i][r]&&c(e,t,n,1,i,r)?1:e[i][r]))}(l,o,a)}),h(l,o,a,!1,i.isInnerEdge)}(a,s,o,t)),a}(r,a,l);return b=a.rotationNum>1?m(function(e,t){const n=e.length,i=e[0].length,r=n/2,s=i/2,o=Math.max(n,i),a=2*Math.round(1.5*o/2),l=2*Math.round(1.5*o/2),u=a/2,h=l/2;let c={x:0,y:0};return p(t,o=>{const d=-o*Math.PI*2/t;return p(a,t=>p(l,o=>{c.x=t-u,c.y=o-h,function(e,t){const n=e.x;e.x=Math.cos(t)*n-Math.sin(t)*e.y,e.y=Math.sin(t)*n+Math.cos(t)*e.y}(c,d);const a=Math.round(c.x+r),l=Math.round(c.y+s);return a<0||a>=n||l<0||l>=i?0:e[a][l]}))})}(v,a.rotationNum),e=>d(e,a)):[d(v,a)],i[o]=b,b}function a(e,t={},n=!1){t.baseSeed=s;let i=Array.isArray(e)?e:e.split("\n");const a=JSON.stringify({patterns:i,options:t});if(r[a])return r[a];const l=o(i,t),h=l[0].length,c=l[0][0].length,d=document.createElement("canvas");d.width=h,d.height=c;const f=d.getContext("2d");let p=[],g=[];for(let e=0;e<l.length;e++){f.clearRect(0,0,h,c),u(f,l,h/2,c/2,e);const t=new Image;n&&g.push(new Promise((e,n)=>{t.onload=(n=>{e(t)})})),t.src=d.toDataURL(),p.push(t)}return r[a]=p,n?Promise.all(g):p}t.generate=o,t.generateImages=function(e,t={}){return a(e,t)},t.generateImagesPromise=function(e,t={}){return a(e,t,!0)},t.setSeed=function(e=0){s=e},t.setDefaultOptions=function(e){g(e,(e,n)=>{t.defaultOptions[n]=e})};class l{constructor(){this.r=0,this.g=0,this.b=0,this.isEmpty=!0}setFromHsv(e,t,n,i=!1){this.isEmpty=!1,this.r=n,this.g=n,this.b=n;const r=6*e,s=Math.floor(r),o=r-s;switch(s){case 0:this.g*=1-t*(1-o),this.b*=1-t;break;case 1:this.b*=1-t,this.r*=1-t*o;break;case 2:this.b*=1-t*(1-o),this.r*=1-t;break;case 3:this.r*=1-t,this.g*=1-t*o;break;case 4:this.r*=1-t*(1-o),this.g*=1-t;break;case 5:this.g*=1-t,this.b*=1-t*o}!0===i&&(this.r=this.limitColor(this.r),this.g=this.limitColor(this.g),this.b=this.limitColor(this.b)),this.setStyle()}setStyle(){const e=Math.floor(255*this.r),t=Math.floor(255*this.g),n=Math.floor(255*this.b);this.style=`rgb(${e},${t},${n})`}limitColor(e){return e<.25?0:e<.75?.5:1}}function u(e,t,n,i,r=0){const s=t[r],o=s.length,a=s[0].length,l=Math.floor(n-o/2),u=Math.floor(i-a/2);for(let t=0,n=u;t<a;t++,n++)for(let i=0,r=l;i<o;i++,r++){const o=s[i][t];o.isEmpty||(e.fillStyle=o.style,e.fillRect(r,n,1,1))}}function h(e,t,n,i,r){let s;return s=i?r?(i,r)=>1===Math.ceil(e[i][r])&&c(e,t,n,0,i,r):(i,r)=>0===e[i][r]&&c(e,t,n,null,i,r,e=>0!==e):r?(i,r)=>1===e[i][r]&&c(e,t,n,0,i,r):(i,r)=>0===e[i][r]&&c(e,t,n,1,i,r),p(t,t=>p(n,n=>s(t,n)?-1:e[t][n]))}function c(e,t,n,i,r,s,o=null){return[[-1,0],[1,0],[0,-1],[0,1]].some(a=>{const l=r+a[0],u=s+a[1];return!(l<0||l>=t||u<0||u>=n)&&(null==o?e[l][u]===i:o(e[l][u]))})}function d(e,t){const n=e.length,i=e[0].length;let r=0,s=!1;for(let t=0;t<i/2;t++){for(let r=0;r<n;r++)if(0!==e[r][t]||0!==e[r][i-1-t]){s=!0;break}if(s)break;r++}let o=i-2*r;o<=0&&(o=1);const a=new S;return a.setSeed(t.seed),p(n,n=>p(i,i=>{const s=e[n][i];if(1===s&&!t.isShowingBody||-1===s&&!t.isShowingEdge)return new l;if(0!==s){let e=((Math.sin((i-r)/o*Math.PI)*t.colorLighting+(1-t.colorLighting))*(1-t.colorNoise)+a.get()*t.colorNoise)*t.value;e=e>=0?e<=1?e:1:0,-1===s&&(e*=1-t.edgeDarkness);const n=new l;return n.setFromHsv(t.hue,t.saturation,e,t.isLimitingColors),n}return new l}))}function f(e,t){for(let n=0;n<e;n++)t(n)}function p(e,t){let n=[];for(let i=0;i<e;i++)n.push(t(i));return n}function g(e,t){for(let n in e)t(e[n],n)}function m(e,t){let n=[];for(let i=0;i<e.length;i++)n.push(t(e[i],i));return n}function y(e,t,n){let i=n;for(let n=0;n<e.length;n++)i=t(i,e[n],n);return i}t.Pixel=l,t.draw=u,t.drawImage=function(e,t,n,i,r=0){const s=t[r];e.drawImage(s,Math.floor(n-s.width/2),Math.floor(i-s.height/2))};class S{get(e=1,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()/4294967295*(t-e)+e}getInt(e,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()%(t-e)+e}getPm(){return 2*this.getInt(2)-1}select(e){return e[this.getInt(e.length)]}setSeed(e=null,t=123456789,n=362436069,i=521288629,r=32){this.w=null!=e?e>>>0:Math.floor(4294967295*Math.random())>>>0,this.x=t>>>0,this.y=n>>>0,this.z=i>>>0;for(let e=0;e<r;e++)this.getToMaxInt();return this}getToMaxInt(){const e=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=(this.w^this.w>>>19^e^e>>>8)>>>0,this.w}constructor(){this.setSeed(),this.get=this.get.bind(this),this.getToMaxInt=this.getToMaxInt.bind(this)}}}])},function(e,t,n){window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){var n;!function(e){"use strict";String.fromCharCode;var t=2*+Math.PI,n=16,i=1,r=Math.sin,s=Math.pow,o=Math.abs;e.SampleRate=0,e.Sec=0,e.SetSampleRate=function(t){e.SampleRate=0|t,e.Sec=0|t},e.SetSampleRate(void 0!==a?(new a).sampleRate:44100),e.Sound=function(t){var n=new c(t,e.DefaultModules),i=w(n.getSamplesLeft());return n.generate(i),g(i)},e.Sounds=function(t,n,i){var r={},s={};s._audio=r;var o=[];v(t,function(e,t){s[t]=function(){void 0!==r[t]&&(r[t].currentTime=0,r[t].play())},o.push(t)});var a=0,l=o.length;return function s(){if(0!=o.length){var u=o.shift();r[u]=e.Sound(t[u]),i&&i(u,++a,l),window.setTimeout(s,30)}else n&&n(sounds)}(),s},e.SoundsImmediate=function(t){var n={},i={};return i._audio=n,v(t,function(t,r){n[r]=e.Sound(t),i[r]=function(){void 0!==n[r]&&(n[r].currentTime=0,n[r].play())}}),i};var a=window.AudioContext||window.webkitAudioContext;void 0!==a?(e.Node=function(t,n,i,r,s){var o=t.createScriptProcessor(r,0,1),a=new c(n,i||e.DefaultModules);return o.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0);a.generate(t),!s&&a.finished&&setTimeout(function(){o.disconnect()},30)},o},e.Live=function(t,n,i){i=i||2048;var r={},s=new a,o=s.createGain();function l(e,t){var n=s.createBufferSource();if(n.buffer=e,null!=t&&null!=n.playbackRate){const e=Math.pow(2,1/12);n.playbackRate.value=Math.pow(e,t/100)}return n.start=n.start||n.noteOn,n}return o.connect(s.destination),r._context=s,r._volume=o,v(t,function(t,a){r[a]=function(){e.Node(s,t,n,i).connect(o)}}),r._close=function(){s.close()},r._play=function(t){e.Node(s,t,n,i).connect(o)},r._createBuffer=function(t){var n=new c(t,e.DefaultModules),i=w(n.getSamplesLeft());return n.generate(i),r._createBufferFromBlock(i)},r._createEmptyBuffer=function(){return r._createBufferFromBlock([0])},r._createBufferFromBlock=function(t){var n=s.createBuffer(1,t.length,e.SampleRate);return n.getChannelData(0).set(t),n},r._playBuffer=function(e,t,n){var i=l(e,n);i.connect(o),i.start(t)},r._playBufferAndConnect=function(e,t,n,i){var r=l(e,i);r.connect(n),n.connect(o),r.start(t)},r._createGain=function(){return s.createGain()},r}):e.Live=function(e,t,n){return null},e.Module={},e.G={};var l=e.stage={PhaseSpeed:0,PhaseSpeedMod:10,Generator:20,SampleMod:30,Volume:40};function u(e,t){return e.stage-t.stage}function h(e,t){for(var n=0;n<t.length;n+=1){var i=t[n],r=e[i.name]||{};v(i.params,function(e,t){void 0===r[t]&&(r[t]=e.D)}),e[i.name]=r}}function c(t,n){t=t||{},n=n||e.DefaultModules,t="function"==typeof t?t():JSON.parse(JSON.stringify(t)),this.finished=!1,this.state={SampleRate:t.SampleRate||e.SampleRate},(n=n.slice()).sort(u),this.modules=n,h(t,n);for(var i=0;i<this.modules.length;i+=1){var r=this.modules[i];this.modules[i].setup(this.state,t[r.name])}}function d(){return v(e.Module,function(){return{}})}function f(e){for(var t in e)0==x(e[t]).length&&delete e[t]}function p(e){return new Function("$","block","var TAU = Math.PI * 2;\nvar sample;\nvar phase = +$.generatorPhase,\n\tA = +$.generatorA, ASlide = +$.generatorASlide,\n\tB = +$.generatorB, BSlide = +$.generatorBSlide;\n\nfor(var i = 0; i < block.length; i++){\n\tvar phaseSpeed = block[i];\n\tphase += phaseSpeed;\n\tif(phase > TAU){ phase -= TAU };\n\tA += ASlide; B += BSlide;\n   A = A < 0 ? 0 : A > 1 ? 1 : A;\n   B = B < 0 ? 0 : B > 1 ? 1 : B;\n"+e+"\tblock[i] = sample;\n}\n\n$.generatorPhase = phase;\n$.generatorA = A;\n$.generatorB = B;\nreturn block.length;\n")}function g(t){"undefined"!=typeof Float32Array&&y(t instanceof Float32Array,"data must be an Float32Array");var r=i*n>>3,s=e.SampleRate*r,o=function(e){if("undefined"==typeof Uint8Array)for(var t=new Array(e),n=0;n<t.length;n++)t[n]=0;return new Uint8Array(e)}(44+2*t.length),a=0;function l(e){for(var t=0;t<e.length;t+=1)o[a]=e.charCodeAt(t),a++}function u(e,t){t<=0||(o[a]=255&e,a++,u(e>>8,t-1))}return l("RIFF"),u(36+2*t.length,4),l("WAVEfmt "),u(16,4),u(1,2),u(i,2),u(e.SampleRate,4),u(s,4),u(r,2),u(n,2),l("data"),u(2*t.length,4),m(o.subarray(a),t),new Audio("data:audio/wav;base64,"+function(e){for(var t="",n=0;n<e.length;n+=32768){var i=Math.min(n+32768,e.length);t+=String.fromCharCode.apply(null,e.subarray(n,i))}return btoa(t)}(o))}function m(e,t){y(e.length/2==t.length,"the target buffer must be twice as large as the iinput");for(var n=0,i=0;i<t.length;i++){var r=32767*+t[i]|0;r=r<-32768?-32768:32767<r?32767:r,r+=r<0?65536:0,e[n]=255&r,e[++n]=r>>8,n++}}function y(e,t){if(!e)throw new Error(t)}function S(e,t,n){return n=+n,(e=+e)<(t=+t)?+t:e>n?+n:+e}function b(e){return(e=+e)<0?0:e>1?1:+e}function v(e,t){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=t(e[i],i));return n}function M(e,t){var n=F();return void 0!==e&&(n*=e),void 0!==t&&(n+=t),n}function P(e){return e[e.length*F()|0]}function x(e){var t=[];for(var n in e)t.push(n);return t}function w(e){if("undefined"==typeof Float32Array)for(var t=new Array(e),n=0;n<t.length;n++)t[n]=0;return new Float32Array(e)}e.InitDefaultParams=h,e.Processor=c,c.prototype={generate:function(e){for(var t=0;t<e.length;t+=1)e[t]=0;if(!this.finished){var n=this.state,i=0|e.length;for(t=0;t<this.modules.length;t+=1){var r=0|this.modules[t].process(n,e.subarray(0,i));i=Math.min(i,r)}for(i<e.length&&(this.finished=!0),t=i;t<e.length;t++)e[t]=0}},getSamplesLeft:function(){for(var e=0,t=0;t<this.state.envelopes.length;t+=1)e+=this.state.envelopes[t].N;return 0===e&&(e=3*this.state.SampleRate),e}},e.Module.Frequency={name:"Frequency",params:{Start:{L:30,H:1800,D:440},Min:{L:30,H:1800,D:30},Max:{L:30,H:1800,D:1800},Slide:{L:-1,H:1,D:0},DeltaSlide:{L:-1,H:1,D:0},RepeatSpeed:{L:0,H:3,D:0},ChangeAmount:{L:-12,H:12,D:0},ChangeSpeed:{L:0,H:1,D:0}},stage:l.PhaseSpeed,setup:function(e,n){var i=e.SampleRate;e.phaseParams=n,e.phaseSpeed=n.Start*t/i,e.phaseSpeedMax=n.Max*t/i,e.phaseSpeedMin=n.Min*t/i,e.phaseSpeedMin=Math.min(e.phaseSpeedMin,e.phaseSpeed),e.phaseSpeedMax=Math.max(e.phaseSpeedMax,e.phaseSpeed),e.phaseSlide=1+64*s(n.Slide,3)/i,e.phaseDeltaSlide=s(n.DeltaSlide,3)/(1e3*i),e.repeatTime=0,e.repeatLimit=1/0,n.RepeatSpeed>0&&(e.repeatLimit=n.RepeatSpeed*i),e.arpeggiatorTime=0,e.arpeggiatorLimit=n.ChangeSpeed*i,0==n.ChangeAmount&&(e.arpeggiatorLimit=1/0),e.arpeggiatorMod=1+n.ChangeAmount/12},process:function(e,t){for(var n=+e.phaseSpeed,i=+e.phaseSpeedMin,r=+e.phaseSpeedMax,s=+e.phaseSlide,o=+e.phaseDeltaSlide,a=e.repeatTime,l=e.repeatLimit,u=e.arpeggiatorTime,h=e.arpeggiatorLimit,c=e.arpeggiatorMod,d=0;d<t.length;d++){if(n=(n*=s+=o)<i?i:n>r?r:n,a>l)return this.setup(e,e.phaseParams),d+this.process(e,t.subarray(d))-1;a++,u>h&&(n*=c,u=0,h=1/0),u++,t[d]+=n}return e.repeatTime=a,e.arpeggiatorTime=u,e.arpeggiatorLimit=h,e.phaseSpeed=n,e.phaseSlide=s,t.length}},e.Module.Vibrato={name:"Vibrato",params:{Depth:{L:0,H:1,D:0},DepthSlide:{L:-1,H:1,D:0},Frequency:{L:.01,H:48,D:0},FrequencySlide:{L:-1,H:1,D:0}},stage:l.PhaseSpeedMod,setup:function(e,n){var i=e.SampleRate;e.vibratoPhase=0,e.vibratoDepth=n.Depth,e.vibratoPhaseSpeed=n.Frequency*t/i,e.vibratoPhaseSpeedSlide=1+3*s(n.FrequencySlide,3)/i,e.vibratoDepthSlide=n.DepthSlide/i},process:function(e,n){var i=+e.vibratoPhase,s=+e.vibratoDepth,o=+e.vibratoPhaseSpeed,a=+e.vibratoPhaseSpeedSlide,l=+e.vibratoDepthSlide;if(0==s&&l<=0)return n.length;for(var u=0;u<n.length;u++)(i+=o)>t&&(i-=t),n[u]+=n[u]*r(i)*s,o*=a,s=b(s+=l);return e.vibratoPhase=i,e.vibratoDepth=s,e.vibratoPhaseSpeed=o,n.length}},e.Module.Generator={name:"Generator",params:{Func:{C:e.G,D:"square"},A:{L:0,H:1,D:0},B:{L:0,H:1,D:0},ASlide:{L:-1,H:1,D:0},BSlide:{L:-1,H:1,D:0}},stage:l.Generator,setup:function(t,n){t.generatorPhase=0,"string"==typeof n.Func?t.generator=e.G[n.Func]:t.generator=n.Func,"object"==typeof t.generator&&(t.generator=t.generator.create()),y("function"==typeof t.generator,"generator must be a function"),t.generatorA=n.A,t.generatorASlide=n.ASlide,t.generatorB=n.B,t.generatorBSlide=n.BSlide},process:function(e,t){return e.generator(e,t)}},e.Module.Guitar={name:"Guitar",params:{A:{L:0,H:1,D:1},B:{L:0,H:1,D:1},C:{L:0,H:1,D:1}},stage:l.Generator,setup:function(e,t){e.guitarA=t.A,e.guitarB=t.B,e.guitarC=t.C,e.guitarBuffer=w(65536),e.guitarHead=0;for(var n=e.guitarBuffer,i=0;i<n.length;i++)n[i]=2*F()-1},process:function(e,n){for(var i=65536,r=i-1,s=+e.guitarA,o=+e.guitarB,a=+e.guitarC,l=s+o+a,u=e.guitarHead,h=e.guitarBuffer,c=0;c<n.length;c++){var d=t/n[c]|0,f=u-(d=d>i?i:d)+i&r;h[u]=(h[f-0+i&r]*s+h[f-1+i&r]*o+h[f-2+i&r]*a)/l,n[c]=h[u],u=u+1&r}return e.guitarHead=u,n.length}},e.Module.Filter={name:"Filter",params:{LP:{L:0,H:1,D:1},LPSlide:{L:-1,H:1,D:0},LPResonance:{L:0,H:1,D:0},HP:{L:0,H:1,D:0},HPSlide:{L:-1,H:1,D:0}},stage:l.SampleMod+0,setup:function(e,t){e.FilterEnabled=t.HP>1e-6||t.LP<1-1e-6,e.LPEnabled=t.LP<1-1e-6,e.LP=s(t.LP,3)/10,e.LPSlide=1+100*t.LPSlide/e.SampleRate,e.LPPos=0,e.LPPosSlide=0,e.LPDamping=5/(1+20*s(t.LPResonance,2))*(.01+t.LP),e.LPDamping=1-Math.min(e.LPDamping,.8),e.HP=s(t.HP,2)/10,e.HPPos=0,e.HPSlide=1+100*t.HPSlide/e.SampleRate},enabled:function(e){return e.FilterEnabled},process:function(e,t){if(!this.enabled(e))return t.length;for(var n=+e.LP,i=+e.LPPos,r=+e.LPPosSlide,s=+e.LPSlide,o=+e.LPDamping,a=+e.LPEnabled,l=+e.HP,u=+e.HPPos,h=+e.HPSlide,c=0;c<t.length;c++){(l>1e-6||l<-1e-6)&&(l=(l*=h)<1e-6?1e-6:l>.1?.1:l);var d=i;n=(n*=s)<0?n=0:n>.1?.1:n;var f=t[c];a?(r+=(f-i)*n,r*=o):(i=f,r=0),u+=(i+=r)-d,u*=1-l,t[c]=u}return e.LPPos=i,e.LPPosSlide=r,e.LP=n,e.HP=l,e.HPPos=u,t.length}},e.Module.Phaser={name:"Phaser",params:{Offset:{L:-1,H:1,D:0},Sweep:{L:-1,H:1,D:0}},stage:l.SampleMod+1,setup:function(e,t){e.phaserBuffer=w(1024),e.phaserPos=0,e.phaserOffset=1020*s(t.Offset,2),e.phaserOffsetSlide=4e3*s(t.Sweep,3)/e.SampleRate},enabled:function(e){return o(e.phaserOffsetSlide)>1e-6||o(e.phaserOffset)>1e-6},process:function(e,t){if(!this.enabled(e))return t.length;for(var n=e.phaserBuffer,i=0|e.phaserPos,r=+e.phaserOffset,s=+e.phaserOffsetSlide,o=0;o<t.length;o++){(r+=s)<0&&(r=-r,s=-s),r>1023&&(r=1023,s=0),n[i]=t[o];var a=i-(0|r)+1024&1023;t[o]+=n[a],i=i+1&1023|0}return e.phaserPos=i,e.phaserOffset=r,t.length}},e.Module.Volume={name:"Volume",params:{Master:{L:0,H:1,D:.5},Attack:{L:.001,H:1,D:.01},Sustain:{L:0,H:2,D:.3},Punch:{L:0,H:3,D:1},Decay:{L:.001,H:2,D:1}},stage:l.Volume,setup:function(e,t){var n=e.SampleRate,i=t.Master,r=i*(1+t.Punch);e.envelopes=[{S:0,E:i,N:t.Attack*n|0},{S:r,E:i,N:t.Sustain*n|0},{S:i,E:0,N:t.Decay*n|0}];for(var s=0;s<e.envelopes.length;s+=1){var o=e.envelopes[s];o.G=(o.E-o.S)/o.N}},process:function(e,t){for(var n=0;e.envelopes.length>0&&n<t.length;){for(var i=e.envelopes[0],r=i.S,s=i.G,o=0|Math.min(t.length-n,i.N),a=n+o|0;n<a;n+=1)t[n]*=r,r=S(r+=s,0,10);i.S=r,i.N-=o,i.N<=0&&e.envelopes.shift()}return n}},e.DefaultModules=[e.Module.Frequency,e.Module.Vibrato,e.Module.Generator,e.Module.Filter,e.Module.Phaser,e.Module.Volume],e.DefaultModules.sort(u),e.EmptyParams=d,e._RemoveEmptyParams=f,e.Preset={Reset:function(){return d()},Coin:function(){var e=d();return e.Frequency.Start=M(880,660),e.Volume.Sustain=M(.1),e.Volume.Decay=M(.4,.1),e.Volume.Punch=M(.3,.3),M()<.5&&(e.Frequency.ChangeSpeed=M(.15,.1),e.Frequency.ChangeAmount=M(8,4)),f(e),e},Laser:function(){var e=d();return e.Generator.Func=P(["square","saw","sine"]),M()<.33?(e.Frequency.Start=M(880,440),e.Frequency.Min=M(.1),e.Frequency.Slide=M(.3,-.8)):(e.Frequency.Start=M(1200,440),e.Frequency.Min=e.Frequency.Start-M(880,440),e.Frequency.Min<110&&(e.Frequency.Min=110),e.Frequency.Slide=M(.3,-1)),M()<.5?(e.Generator.A=M(.5),e.Generator.ASlide=M(.2)):(e.Generator.A=M(.5,.4),e.Generator.ASlide=M(.7)),e.Volume.Sustain=M(.2,.1),e.Volume.Decay=M(.4),M()<.5&&(e.Volume.Punch=M(.3)),M()<.33&&(e.Phaser.Offset=M(.2),e.Phaser.Sweep=M(.2)),M()<.5&&(e.Filter.HP=M(.3)),f(e),e},Explosion:function(){var e=d();return e.Generator.Func="noise",M()<.5?(e.Frequency.Start=M(440,40),e.Frequency.Slide=M(.4,-.1)):(e.Frequency.Start=M(1600,220),e.Frequency.Slide=M(-.2,-.2)),M()<.2&&(e.Frequency.Slide=0),M()<.3&&(e.Frequency.RepeatSpeed=M(.5,.3)),e.Volume.Sustain=M(.3,.1),e.Volume.Decay=M(.5),e.Volume.Punch=M(.6,.2),M()<.5&&(e.Phaser.Offset=M(.9,-.3),e.Phaser.Sweep=M(-.3)),M()<.33&&(e.Frequency.ChangeSpeed=M(.3,.6),e.Frequency.ChangeAmount=M(24,-12)),f(e),e},Powerup:function(){var e=d();return M()<.5?e.Generator.Func="saw":e.Generator.A=M(.6),e.Frequency.Start=M(220,440),M()<.5?(e.Frequency.Slide=M(.5,.2),e.Frequency.RepeatSpeed=M(.4,.4)):(e.Frequency.Slide=M(.2,.05),M()<.5&&(e.Vibrato.Depth=M(.6,.1),e.Vibrato.Frequency=M(30,10))),e.Volume.Sustain=M(.4),e.Volume.Decay=M(.4,.1),f(e),e},Hit:function(){var e=d();return e.Generator.Func=P(["square","saw","noise"]),e.Generator.A=M(.6),e.Generator.ASlide=M(1,-.5),e.Frequency.Start=M(880,220),e.Frequency.Slide=-M(.4,.3),e.Volume.Sustain=M(.1),e.Volume.Decay=M(.2,.1),M()<.5&&(e.Filter.HP=M(.3)),f(e),e},Jump:function(){var e=d();return e.Generator.Func="square",e.Generator.A=M(.6),e.Frequency.Start=M(330,330),e.Frequency.Slide=M(.4,.2),e.Volume.Sustain=M(.3,.1),e.Volume.Decay=M(.2,.1),M()<.5&&(e.Filter.HP=M(.3)),M()<.3&&(e.Filter.LP=M(-.6,1)),f(e),e},Select:function(){var e=d();return e.Generator.Func=P(["square","saw"]),e.Generator.A=M(.6),e.Frequency.Start=M(660,220),e.Volume.Sustain=M(.1,.1),e.Volume.Decay=M(.2),e.Filter.HP=.2,f(e),e},Lucky:function(){var t=d();return v(t,function(t,n){v(e.Module[n].params,function(e,n){if(e.C){var i=x(e.C);t[n]=i[i.length*F()|0]}else t[n]=F()*(e.H-e.L)+e.L})}),t.Volume.Master=.4,t.Filter={},f(t),t}},e.G.unoise=p("sample = Math.random();"),e.G.sine=p("sample = Math.sin(phase);"),e.G.saw=p("sample = 2*(phase/TAU - ((phase/TAU + 0.5)|0));"),e.G.triangle=p("sample = Math.abs(4 * ((phase/TAU - 0.25)%1) - 2) - 1;"),e.G.square=p("var s = Math.sin(phase); sample = s > A ? 1.0 : s < A ? -1.0 : A;"),e.G.synth=p("sample = Math.sin(phase) + .5*Math.sin(phase/2) + .3*Math.sin(phase/4);"),e.G.noise=p("if(phase % TAU < 4){__noiseLast = Math.random() * 2 - 1;} sample = __noiseLast;"),e.G.string={create:function(){for(var e=65536,t=e-1,n=w(e),i=0;i<n.length;i++)n[i]=2*F()-1;var r=0;return function(i,s){for(var o=2*Math.PI,a=+i.generatorA,l=+i.generatorASlide,u=+i.generatorB,h=+i.generatorBSlide,c=n,d=0;d<s.length;d++){var f=s[d];u+=h,a=(a+=l)<0?0:a>1?1:a,u=u<0?0:u>1?1:u;var p=r-(o/f|0)+e&t,g=(1*c[p-0+e&t]+c[p-1+e&t]*a+c[p-2+e&t]*u)/(1+a+u);c[r]=g,s[d]=c[r],r=r+1&t}return i.generatorA=a,i.generatorB=u,s.length}}},e.CreateAudio=g,e.DownloadAsFile=function(e){y(e instanceof Audio,"input must be an Audio object"),document.location.href=e.src},e.Util={},e.Util.CopyFToU8=m,e._createFloatArray=w;var L=Math.random;function F(){return L()}e.setRandomFunc=function(e){L=e}}(n={}),e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);let r,s;t.Preset=i.Preset;let o,a,l={},u={},h=[];const c={c:t.Preset.Coin,l:t.Preset.Laser,e:t.Preset.Explosion,p:t.Preset.Powerup,h:t.Preset.Hit,j:t.Preset.Jump,s:t.Preset.Select,u:t.Preset.Lucky},d=function(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}(c);let f,p=.5,g=!1;function m(e){null!=r&&(r._volume.gain.value=e)}function y(){null!=r&&A(h,e=>e.stop())}function S(e=32,t=.25,n,i=60,r=1,o=0,a=0,l=1,u=!1,h=!1,c=!1,d=!1,p=null){const g=new F(n,b(i),r);if(g.noteInterval=t,null!=f&&u)g.noteRatios=f.noteRatios;else{const t=null!=p?function(e,t){return k(e,()=>s.get()>=t)}(e,p):function(e){let t=D(e,!1),n=4;for(;n<=e;)t=v(t,n),n*=2;return t}(e);g.noteRatios=function(e,t,n,i,r){let o=s.get(),a=s.get(-.5,.5),l=e.length/x.length,u=[];return e.forEach((e,n)=>{let h=Math.floor(n/l),c=n%l;if(r&&h===Math.floor(x.length/2))return u.push(u[c]),void(null!=u[c]&&(o=u[c]));e?(u.push(o),a+=s.get(-.25,.25),o+=a*i,(s.get()<.2||o<=t||o>=1)&&(o-=2*a,a*=-1)):u.push(null)}),u}(t,h?0:-1,0,l,d)}return g.notes=function(e,t,n,i){let r=e.length/x.length;return e.map((e,o)=>{if(null==e)return null;let a=Math.floor(o/r),l=x[a][0],u=M[x[a][1]],h=e;i&&(h=Math.floor(2*h)/2);let c=Math.floor(h),d=Math.floor((h-c)*u.length);for(d+=t+s.getInt(-n,n+1);d>=u.length;)d-=u.length,c++;for(;d<0;)d+=u.length,c--;return 100*(l+12*c+u[d])})}(g.noteRatios,o,a,c),f=g,g}function b(e){return 440*Math.pow(2,(e-69)/12)}function v(e,t){let n=D(t,!1);const i=Math.floor(4*Math.abs(s.get()+s.get()-1));for(let e=0;e<i;e++)n[s.getInt(t-1)]=!0;return C(e,(e,i)=>n[i%t]?!e:e)}t.init=function(e=0,n=120,l=60){r=i.Live({}),m(.1),a=e,s=new class{get(e=1,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()/4294967295*(t-e)+e}getInt(e,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()%(t-e)+e}getPm(){return 2*this.getInt(2)-1}select(e){return e[this.getInt(e.length)]}setSeed(e=null,t=123456789,n=362436069,i=521288629,r=32){this.w=null!=e?e>>>0:Math.floor(4294967295*Math.random())>>>0,this.x=t>>>0,this.y=n>>>0,this.z=i>>>0;for(let e=0;e<r;e++)this.getToMaxInt();return this}getToMaxInt(){const e=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=(this.w^this.w>>>19^e^e>>>8)>>>0,this.w}constructor(){this.setSeed(),this.get=this.get.bind(this),this.getToMaxInt=this.getToMaxInt.bind(this)}},i.setRandomFunc(s.get),t.playInterval=60/n,o=1/l*2},t.setSeed=function(e=0){a=e},t.play=function(e="0",t=2,n=null,i=null,o=null){if(null==r)return;if(null!=l[e])return void l[e].play(o);if(s.setSeed(a+T(e)),null==i){let n=c[e[0]];void 0===n&&(n=s.select(d)),i=D(t,n)}const u=null==n?null:b(n);l[e]=new L(i,u),l[e].play(o)},t.playJingle=function(e="0",t=!1,n=57,i=16,o=.25,l=4,h=null,p=null){if(null==r)return;if(null!=u[e])return void u[e].forEach(e=>e.play(p));if(s.setSeed(a+T(e)),w(),f=null,null==h){let t=c[e[0]];void 0===t&&(t=s.select(d)),h=t}let g=.8;t&&(o/=4,g/=2),u[e]=k(l,()=>{const e=Math.floor(3*Math.abs(s.get()+s.get()-1)),r=Math.floor(10*(s.get()+s.get()-1)),a=t?2:Math.abs(s.get()+s.get()-1),l=s.get()<.25,u=!t&&s.get()<.5,c=s.get()<.5,d=t?s.get()<.25:s.get()<.9,f=s.get(.5),p=S(i,o,h,n,g,e,r,a,l,u,c,d,f);return p.isLooping=!1,p}),u[e].forEach(e=>e.play(p))},t.stopJingles=function(){R(u,e=>A(e,e=>e.stop()))},t.setVolume=m,t.setQuantize=function(e){p=e},t.update=function(){if(null==r)return;const e=r._context.currentTime,t=e+o;return R(l,n=>n.update(e,t)),R(u,n=>A(n,n=>n.update(e,t))),A(h,n=>n.update(e,t)),e},t.reset=function(){y(),l={},u={},h=[]},t.playEmpty=function(){if(null==r)return;if(g)return;const e=r._createEmptyBuffer();r._playBuffer(e,0),g=!0},t.playParam=function(e){null!=r&&r._play(e)},t.playBgm=function(e="0",n=45,i=32,o=.25,l=4,u=[t.Preset.Laser,t.Preset.Select,t.Preset.Hit,t.Preset.Hit],c=null){if(null==r)return;y(),s.setSeed(a+T(e)),w(),f=null;let d=s.select(u);A(h=k(l,()=>{const e=Math.floor(3*Math.abs(s.get()+s.get()-1)),t=Math.floor(10*(s.get()+s.get()-1)),r=Math.abs(s.get()+s.get()-1),a=s.get()<.25;a||(d=s.select(u));const l=s.get()<.5,h=s.get()<.5,c=s.get()<.9;return S(i,o,d,n,.7,e,t,r,a,l,h,c)}),e=>e.play(c))},t.stopBgm=y;const M=[[0,4,7],[0,3,7],[0,4,7,10],[0,4,7,11],[0,3,7,10]],P=[[[0,0],[7,0],[9,1],[4,1]],[[5,0],[0,0],[5,0],[7,0]],[[5,3],[7,2],[4,4],[9,1]],[[9,1],[2,1],[7,0],[0,0]],[[9,1],[5,0],[7,0],[0,0]]];let x;function w(){const e=s.select(P);x=e.map((e,t)=>[s.get()<.7?e[0]:P[s.getInt(P.length)][t][0],s.get()<.7?e[1]:s.getInt(M.length)])}class L{constructor(e,t=null,n=1){this.isPlaying=!1,this.playedTime=null,Array.isArray(e)||(e=[e]),this.buffers=C(e,e=>(e instanceof Function&&(e=e()),e.Volume.Sustain*=n,e.Volume.Decay*=n,null!=t&&(e.Frequency.Start=t),r._createBuffer(e))),this.gainNode=r._createGain()}play(e=null){this.isPlaying=!0,this.volume=e}stop(){this.isPlaying=!1}update(e,n){if(!this.isPlaying)return;this.isPlaying=!1;const i=t.playInterval*p,r=i>0?Math.ceil(e/i)*i:e;(null==this.playedTime||r>this.playedTime)&&(this.playLater(r),this.playedTime=r)}playLater(e,t=null){null==this.volume?A(this.buffers,n=>r._playBuffer(n,e,t)):(this.gainNode.gain.value=this.volume,A(this.buffers,n=>r._playBufferAndConnect(n,e,this.gainNode,t)))}}class F extends L{constructor(){super(...arguments),this.noteIndex=0,this.noteInterval=.25,this.scheduledTime=null,this.isLooping=!0}play(e=null){super.play(e),this.scheduledTime=null}update(e,t){if(this.isPlaying){null==this.scheduledTime&&this.calcFirstScheduledTime(e);for(let t=0;t<99&&!(this.scheduledTime>=e);t++)this.calcNextScheduledTime();if(this.scheduledTime<e)this.scheduledTime=null;else for(;this.scheduledTime<=t;){if(null!=this.nextNote&&this.playLater(this.scheduledTime,this.nextNote),!this.isLooping&&0===this.noteIndex)return void this.stop();this.calcNextScheduledTime()}}}calcFirstScheduledTime(e){this.scheduledTime=Math.ceil(e/t.playInterval)*t.playInterval-t.playInterval*this.noteInterval,this.noteIndex=0,this.calcNextScheduledTime()}calcNextScheduledTime(){const e=this.notes.length,n=t.playInterval*this.noteInterval;for(let t=0;t<e&&(this.scheduledTime+=n,this.nextNote=this.notes[this.noteIndex],this.noteIndex++,!(this.noteIndex>=e)||(this.noteIndex=0,this.isLooping))&&null==this.nextNote;t++);}}function T(e){let t=0;const n=e.length;for(let i=0;i<n;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function D(e,t){let n=[];for(let i=0;i<e;i++)n.push(t);return n}function k(e,t){let n=[];for(let i=0;i<e;i++)n.push(t(i));return n}function A(e,t){for(let n=0;n<e.length;n++)t(e[n])}function R(e,t){for(let n in e)t(e[n])}function C(e,t){let n=[];for(let i=0;i<e.length;i++)n.push(t(e[i],i));return n}}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initSeedUi=function(e){var t=document.createElement("p");t.innerHTML='<button id="change">change</button>random seed: <input type="number" id="seed" value="0"></input><button id="set">set</button>',document.getElementsByTagName("body")[0].appendChild(t);var n=document.getElementById("change"),i=document.getElementById("seed"),r=document.getElementById("set");function s(){e(Number(i.value))}n.onclick=function(){i.value=Math.floor(9999999*Math.random()).toString(),s()},r.onclick=s},t.enableShowingErrors=function(){var e=document.createElement("pre");e.setAttribute("id","result"),document.getElementsByTagName("body")[0].appendChild(e),window.addEventListener("error",function(t){var n=[t.filename,"@",t.lineno,":\n",t.message].join("");return e.textContent+="\n"+n,!1})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.options={scaleRatio:1,canvas:null,isLimitingColors:!1};let i,r={},s=0,o=[];function a(){for(let e=0;e<o.length;e++){o[e].clear()}}t.emit=function(e,t,n,o=0,a={},u=i){if(null==u&&null==i&&(u=i=new h),null==r[e]){const t=new p;t.setSeed(s+function(e){let t=0;const n=e.length;for(let i=0;i<n;i++){const n=e.charCodeAt(i);t=(t<<5)-t+n,t|=0}return t}(e)),r[e]=new l(e[0],a,t)}const c=null==a.velX?0:a.velX,d=null==a.velY?0:a.velY;r[e].emit(t,n,o,c,d,u)},t.update=function(){for(let e=0;e<o.length;e++)o[e].update()},t.getParticles=function(){return i.particles},t.setSeed=function(e=0){s=e},t.reset=function(){r={},a()},t.clear=a,t.clearPools=function(){o=[],i=new h},t.setOptions=function(e){for(let n in e)t.options[n]=e[n]};class l{constructor(e,n,i){this.base=new u,this.angleDeflection=0,this.speedDeflection=.5,this.sizeDeflection=.5,this.ticksDeflection=.3,this.count=1;const r=null==n.hue?i.get():n.hue,s=null==n.sizeScale?1:n.sizeScale,o=null==n.countScale?1:n.countScale;switch(e){case"e":this.base.speed=.7,this.base.slowdownRatio=.05,this.base.targetSize=10,this.base.beginColor=new d(r,1,.5,.3),this.base.middleColor=new d(r,.2,.9,.1),this.base.endColor=new d(r,0,0,0),this.base.middleTicks=20,this.base.endTicks=30,this.angleDeflection=2*Math.PI,this.count=15;break;case"m":case"s":this.base.speed="m"===e?1.5:.5,this.base.slowdownRatio=.025,this.base.targetSize=5,this.base.beginColor=new d(r,.5,.5,.3),this.base.middleColor=new d(r,1,.9,.3),this.base.endColor=new d(r,.75,.75,.2),this.base.middleTicks=10,this.base.endTicks=20,this.angleDeflection="m"===e?.3*i.getForParam():2*Math.PI,this.count=10;break;case"t":case"j":this.base.speed="t"===e?.1:1,this.base.slowdownRatio=.03,this.base.targetSize="t"===e?3:7,this.base.beginColor=new d(r,.7,.7,.4),this.base.middleColor=new d(r,1,.9,.2),this.base.endColor=new d(r,.7,.7,.1),this.base.middleTicks="t"===e?30:15,this.base.endTicks="t"===e?40:20,this.angleDeflection=.5*i.getForParam(),this.speedDeflection=.1,this.sizeDeflection=.1,this.ticksDeflection=.1,this.count=.5}null!=n.speed&&(this.base.speed=n.speed),null!=n.slowdownRatio&&(this.base.slowdownRatio=n.slowdownRatio),this.base.speed*=s*t.options.scaleRatio,this.base.targetSize*=s*t.options.scaleRatio,this.count*=o,this.base.speed*=i.getForParam(),this.base.slowdownRatio*=i.getForParam(),this.base.targetSize*=i.getForParam();const a=this.base.endTicks-this.base.middleTicks;this.base.middleTicks*=i.getForParam(),this.base.endTicks=this.base.middleTicks+a*i.getForParam(),this.speedDeflection*=i.getForParam(),this.sizeDeflection*=i.getForParam(),this.ticksDeflection*=i.getForParam(),this.count*=i.getForParam()}emit(e,t,n=0,i=0,r=0,s){if(!(this.count<1&&this.count<Math.random()))for(let o=0;o<this.count;o++){const o=new u;o.pos.x=e,o.pos.y=t,o.vel.x=i,o.vel.y=r,o.angle=n+(Math.random()-.5)*this.angleDeflection,o.speed=this.base.speed*((2*Math.random()-1)*this.speedDeflection+1),o.slowdownRatio=this.base.slowdownRatio,o.targetSize=this.base.targetSize*((2*Math.random()-1)*this.sizeDeflection+1),o.middleTicks=this.base.middleTicks*((2*Math.random()-1)*this.ticksDeflection+1),o.endTicks=this.base.endTicks*((2*Math.random()-1)*this.ticksDeflection+1),o.beginColor=this.base.beginColor,o.middleColor=this.base.middleColor,o.endColor=this.base.endColor,s.particles.push(o)}}}t.Emitter=l;class u{constructor(){this.pos=new c,this.vel=new c,this.size=0,this.angle=0,this.speed=1,this.slowdownRatio=.01,this.targetSize=10,this.middleTicks=20,this.endTicks=60,this.ticks=0}update(e){if(this.pos.x+=Math.cos(this.angle)*this.speed+this.vel.x,this.pos.y+=Math.sin(this.angle)*this.speed+this.vel.y,this.speed*=1-this.slowdownRatio,this.vel.x*=.99,this.vel.y*=.99,this.ticks>=this.endTicks)return!1;this.ticks<this.middleTicks?(this.color=this.beginColor.getLerped(this.middleColor,this.ticks/this.middleTicks),this.size+=.1*(this.targetSize-this.size)):(this.color=this.middleColor.getLerped(this.endColor,(this.ticks-this.middleTicks)/(this.endTicks-this.middleTicks)),this.size*=.95),this.color=this.color.getSparkled(),null!=e&&(e.fillStyle=this.color.getStyle(),e.fillRect(this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size)),this.ticks++}}t.Particle=u;class h{constructor(e=t.options.canvas){this.canvas=e,this.particles=[],o.push(this)}update(){null==this.context&&null!=this.canvas&&(this.context=this.canvas.getContext("2d"));for(let e=0;e<this.particles.length;)!1===this.particles[e].update(this.context)?this.particles.splice(e,1):e++}getParticles(){return this.particles}clear(){this.particles=[]}}t.ParticlePool=h;class c{constructor(e=0,t=0){this.x=e,this.y=t}}t.Vector=c;class d{constructor(e=0,n=1,i=1,r=0){this.hue=e,this.saturation=n,this.value=i,this.sparkleRatio=r,this.r=0,this.g=0,this.b=0,this.r=i,this.g=i,this.b=i;const s=6*e,o=Math.floor(s),a=s-o;switch(o){case 0:this.g*=1-n*(1-a),this.b*=1-n;break;case 1:this.b*=1-n,this.r*=1-n*a;break;case 2:this.b*=1-n*(1-a),this.r*=1-n;break;case 3:this.r*=1-n,this.g*=1-n*a;break;case 4:this.r*=1-n*(1-a),this.g*=1-n;break;case 5:this.g*=1-n,this.b*=1-n*a}!0===t.options.isLimitingColors&&this.limitRgb()}getStyle(){return`rgb(${Math.floor(255*this.r)},${Math.floor(255*this.g)},${Math.floor(255*this.b)})`}getSparkled(){return null==this.sparkled&&(this.sparkled=new d),this.sparkled.r=f(this.r+this.sparkleRatio*(2*Math.random()-1)),this.sparkled.g=f(this.g+this.sparkleRatio*(2*Math.random()-1)),this.sparkled.b=f(this.b+this.sparkleRatio*(2*Math.random()-1)),!0===t.options.isLimitingColors&&this.sparkled.limitRgb(),this.sparkled}getLerped(e,n){return null==this.lerped&&(this.lerped=new d),this.lerped.r=this.r*(1-n)+e.r*n,this.lerped.g=this.g*(1-n)+e.g*n,this.lerped.b=this.b*(1-n)+e.b*n,this.lerped.sparkleRatio=this.sparkleRatio*(1-n)+e.sparkleRatio*n,!0===t.options.isLimitingColors&&this.lerped.limitRgb(),this.lerped}limitRgb(){this.r=this.limitColor(this.r),this.g=this.limitColor(this.g),this.b=this.limitColor(this.b)}limitColor(e){return e<.25?0:e<.75?.5:1}}function f(e){return e<=0?0:e>=1?1:e}t.Color=d;class p{get(e=1,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()/4294967295*(t-e)+e}getInt(e,t=null){return null==t&&(t=e,e=0),this.getToMaxInt()%(t-e)+e}getPm(){return 2*this.getInt(2)-1}select(e){return e[this.getInt(e.length)]}getForParam(){return this.get(.5,1.5)}setSeed(e=null,t=123456789,n=362436069,i=521288629,r=32){this.w=null!=e?e>>>0:Math.floor(4294967295*Math.random())>>>0,this.x=t>>>0,this.y=n>>>0,this.z=i>>>0;for(let e=0;e<r;e++)this.getToMaxInt();return this}getToMaxInt(){const e=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=(this.w^this.w>>>19^e^e>>>8)>>>0,this.w}constructor(){this.setSeed(),this.get=this.get.bind(this),this.getToMaxInt=this.getToMaxInt.bind(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(2),s=n(1),o=n(0);let a=!1;const l=16;let u,h,c=[],d=null,f=0,p=0,g={x:0,y:0},m=!1;const y=128;function S(e,t){s.playEmpty(),!a&&f>0&&(a=!0,p=f=0,s.playBgm(),c=[],M(),function(){null!=d&&(d.isAlive=!1);(d={}).pixels=o.generate([" x","xxxx"]),d.pos={x:64,y:64},d.vel={x:0,y:0},d.angle=-Math.PI/2,d.wallTicks=0,d.fireTicks=20,d.update=function(){d.angle+=.2*(g.x/y-.5),d.pos.x+=Math.cos(d.angle),d.pos.y+=Math.sin(d.angle),i.emit("j1",d.pos.x,d.pos.y,d.angle+Math.PI),x(P("wall"),e=>{Math.abs(d.pos.x-e.pos.x)<5&&Math.abs(d.pos.y-e.pos.y)<5&&(d.isAlive=!1,a=!1,f=-60,s.playJingle("u1",!0),s.stopBgm(),i.emit("e2",e.pos.x,e.pos.y,0,{sizeScale:2,countScale:2}))}),--d.wallTicks<=0&&(!function(e,t){const n={};n.pixels=o.generate(["xx","xx"],{isMirrorX:!0,rotationNum:1}),n.pos={x:e,y:t},n.angle=0,n.priority=1,n.update=function(){},n.name="wall",c.push(n),i.emit("s1",e,t)}(d.pos.x-8*Math.cos(d.angle),d.pos.y-8*Math.sin(d.angle)),s.play("c1"),d.wallTicks=80/Math.sqrt(f/1e3+1)),--d.fireTicks<=0&&(!function(){const e={};e.pixels=o.generate(["","xxxx"]),e.pos={x:d.pos.x,y:d.pos.y},e.angle=d.angle,e.ticks=0,e.update=function(){e.pos.x+=2*Math.cos(e.angle),e.pos.y+=2*Math.sin(e.angle),x(P("wall"),t=>{Math.abs(e.pos.x-t.pos.x)<10&&Math.abs(e.pos.y-t.pos.y)<10&&(e.isAlive=!1,t.isAlive=!1,i.emit("e1",t.pos.x,t.pos.y,0,{velX:Math.cos(e.angle),velY:Math.sin(e.angle)}),s.playJingle("e1",!0),p++)}),i.emit("t1",e.pos.x,e.pos.y,e.angle+Math.PI,{countScale:.5}),e.ticks>60&&(e.isAlive=!1),e.ticks++},c.push(e),i.emit("m1",e.pos.x,e.pos.y,e.angle)}(),s.play("s1"),d.fireTicks=40/Math.sqrt(f/2e3+1))},d.priority=0,c.push(d)}()),m=!0,b(e,t)}function b(e,t){g.x=((e-h.offsetLeft)/h.clientWidth+.5)*y,g.y=((t-h.offsetTop)/h.clientHeight+.5)*y}function v(){requestAnimationFrame(v),u.fillStyle="black",u.fillRect(0,0,y,y),i.update(),s.update(),c.sort((e,t)=>e.priority-t.priority),x(c,e=>{e.update();e.pos.x<-4&&(e.pos.x+=136),e.pos.x>132&&(e.pos.x-=136),e.pos.y<-4&&(e.pos.y+=136),e.pos.y>132&&(e.pos.y-=136),function(e){let t=e.angle;t<0&&(t=2*Math.PI-Math.abs(t%(2*Math.PI)));const n=e.pixels[Math.round(t/(2*Math.PI/l))%l],i=n.length,r=n[0].length,s=Math.floor(e.pos.x-i/2);for(let t=0,a=Math.floor(e.pos.y-r/2);t<r;t++,a++)for(let e=0,r=s;e<i;e++,r++){var o=n[e][t];o.isEmpty||(u.fillStyle=o.style,u.fillRect(r,a,1,1))}}(e)});for(let e=0;e<c.length;)!1===c[e].isAlive?c.splice(e,1):e++;u.fillStyle="#ace",u.font="9px monospace",u.fillText(`${p}`,5,10),f++}function M(){for(let e=0;e<32;e++){const e={};e.pixels=o.generate(["o"],{isMirrorY:!1,hue:Math.random(),saturation:.4}),e.pos={x:148*Math.random()-16,y:148*Math.random()-16},e.angle=0,e.update=function(){},e.priority=-1,c.push(e)}}function P(e){let t=[];return x(c,n=>{n.name===e&&t.push(n)}),t}function x(e,t){for(let n=0;n<e.length;n++)t(e[n])}function w(e){o.setSeed(e),s.reset(),s.setSeed(e),i.setSeed(e),i.reset(),a&&s.playBgm()}window.onload=(()=>{r.enableShowingErrors(),r.initSeedUi(w);const e=document.createElement("p");e.innerText="[Mouse/Touch Left/Right]: turn",document.body.appendChild(e),(h=document.createElement("canvas")).width=h.height=y,document.body.appendChild(h),u=h.getContext("2d"),i.setOptions({canvas:h}),o.setDefaultOptions({isMirrorY:!0,rotationNum:l,scalePattern:2}),s.init(),w(8580576),M(),document.addEventListener("mousedown",e=>{S(e.clientX,e.clientY)}),document.addEventListener("touchstart",e=>{S(e.touches[0].clientX,e.touches[0].clientY)}),document.addEventListener("mousemove",e=>{b(e.clientX,e.clientY)}),document.addEventListener("touchmove",e=>{e.preventDefault(),b(e.touches[0].clientX,e.touches[0].clientY)},{passive:!1}),document.addEventListener("touchend",e=>{e.preventDefault(),e.target.click()},{passive:!1}),v()})}]);